<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://pages.github.com/tomklapiscak/mkdocsmike/main/accountrootmanifest/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Account Root Application Manifest - MAS GitOps (test)</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" rel="stylesheet" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Account Root Application Manifest";
        var mkdocs_page_input_path = "accountrootmanifest.md";
        var mkdocs_page_url = "/tomklapiscak/mkdocsmike/main/accountrootmanifest/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> MAS GitOps (test)
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../helmcharts/">The Source Repository</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configrepo/">The Config Repository</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../secrets/">The Secrets Vault</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Details</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../configtoinstances/">Mapping Config to MAS Deployments</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../orchestration/">Deployment Orchestration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Account Root Application Manifest</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#template">Template</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#source-repo-url">&lt;source-repo-url&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#source-repo-revision">&lt;source-repo-revision&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#config-repo">&lt;config-repo&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#config-repo-revision">&lt;config-repo-revision&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#account-id">&lt;account-id&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#argo-namespace">&lt;argo-namespace&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#argo-project-rootapps">&lt;argo-project-rootapps&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#argo-project-apps">&lt;argo-project-apps&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#avp-name">&lt;avp-name&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#avp-secret">&lt;avp-secret&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#avp-values_varname">&lt;avp-values_varname&gt;</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#auto_delete">auto_delete</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../limitations/">Known Limitations</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">MAS GitOps (test)</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Reference</li>
      <li class="breadcrumb-item active">Account Root Application Manifest</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/tomklapiscak/mkdocsmike/blob/main/docs/accountrootmanifest.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="account-root-application-manifest">Account Root Application Manifest<a class="headerlink" href="#account-root-application-manifest" title="Permanent link"></a></h1>
<p>The <strong>Account Root Application</strong> is created directly on the <strong>Management Cluster</strong> running ArgoCD. It serves as the "entrypoint" to the MAS GitOps code and is where several key pieces of global configuration values are provided.</p>
<h3 id="template">Template<a class="headerlink" href="#template" title="Permanent link"></a></h3>
<pre><code class="language-yaml">apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: root.&lt;account-id&gt;
  namespace: &lt;argoapp-namespace&gt;
spec:
  destination:
    namespace: &lt;argoapp-namespace&gt;
    server: https://kubernetes.default.svc
  project: &lt;argo-project-rootapps&gt;
  source:
    path: root-applications/ibm-mas-account-root
    repoURL: &lt;source-repo-url&gt;
    targetRevision: &lt;source-repo-revision&gt;
    helm:
      values: |
          account:
            id: &lt;account-id&gt;

          generator:
            repo_url: &lt;config-repo&gt;
            revision: &lt;config-repo-revision&gt;

          source:
            repo_url: &lt;source-repo-url&gt;
            revision: &lt;source-repo-revision&gt;

          argo:
            namespace: &lt;argo-namespace&gt;
            projects:
              rootapps: &lt;argo-project-rootapps&gt;
              apps: &lt;argo-project-apps&gt;

          avp:
            name: &lt;avp-name&gt;
            secret: &lt;avp-secret&gt;
            values_varname: &lt;val-values-varname&gt;

          auto_delete: &lt;false|true&gt;





  syncPolicy:
    automated:
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
</code></pre>
<h3 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link"></a></h3>
<h4 id="source-repo-url"><code>&lt;source-repo-url&gt;</code><a class="headerlink" href="#source-repo-url" title="Permanent link"></a></h4>
<p>The URL of the Git repository containing the MAS GitOps Helm Charts, e.g. https://github.com/ibm-mas/gitops, aka the <strong>Source Repository</strong></p>
<h4 id="source-repo-revision"><code>&lt;source-repo-revision&gt;</code><a class="headerlink" href="#source-repo-revision" title="Permanent link"></a></h4>
<p>The branch of <code>&lt;source-repo-url&gt;</code> to source the MAS GitOps Helm Charts from, e.g. <code>master</code>.</p>
<h4 id="config-repo"><code>&lt;config-repo&gt;</code><a class="headerlink" href="#config-repo" title="Permanent link"></a></h4>
<p>The Git repository to source MAS cluster/instance configuration from, aka the <strong>Config Repository</strong></p>
<h4 id="config-repo-revision"><code>&lt;config-repo-revision&gt;</code><a class="headerlink" href="#config-repo-revision" title="Permanent link"></a></h4>
<p>The revision of <code>&lt;config-repo&gt;</code> to source cluster/instance configuration from</p>
<h4 id="account-id"><code>&lt;account-id&gt;</code><a class="headerlink" href="#account-id" title="Permanent link"></a></h4>
<p>The ID of the account this root application manages. This also determines the root folder in <code>&lt;config-repo&gt;</code>:<code>&lt;config-repo-revision</code> to source cluster/instance configuration from, e.g. <code>dev</code>.</p>
<h4 id="argo-namespace"><code>&lt;argo-namespace&gt;</code><a class="headerlink" href="#argo-namespace" title="Permanent link"></a></h4>
<p>The namespace in which ArgoCD is installed on the <strong>Management Cluster</strong>. E.g. <code>openshift-gitops</code>, <code>argocd-worker</code>. This determines where Application and ApplicationSet resources will be created. It will also be used to annotate namespaces created by our charts with <a href="https://argocd-operator.readthedocs.io/en/stable/usage/deploy-to-different-namespaces/">argocd.argoproj.io/managed-by</a>.</p>
<h4 id="argo-project-rootapps"><code>&lt;argo-project-rootapps&gt;</code><a class="headerlink" href="#argo-project-rootapps" title="Permanent link"></a></h4>
<p>The ArgoCD project in which to create root applications (including this Application and the root applications that it generates). The project must be configured to permit creation of <code>argoproj.io.Application</code> and <code>argoproj.io.ApplicationSet</code> resources in the <code>&lt;argoapp-namespace&gt;</code> of the cluster in which ArgoCD is running (i.e. <code>https://kubernetes.default.svc</code>).</p>
<h4 id="argo-project-apps"><code>&lt;argo-project-apps&gt;</code><a class="headerlink" href="#argo-project-apps" title="Permanent link"></a></h4>
<p>The ArgoCD project in which to create the applications that deploy MAS resources (and their dependencies) to external MAS clusters. The project must be configured to permit creation of any resource in any namespace of all external MAS clusters targeted by this account.</p>
<h4 id="avp-name"><code>&lt;avp-name&gt;</code><a class="headerlink" href="#avp-name" title="Permanent link"></a></h4>
<p>The name assigned to the ArgoCD Vault Plugin used for retrieving secrets. Defaults to <code>argocd-vault-plugin-helm</code>.</p>
<h4 id="avp-secret"><code>&lt;avp-secret&gt;</code><a class="headerlink" href="#avp-secret" title="Permanent link"></a></h4>
<p>The name of the k8s secret containing the credentials for accessing the vault that AVP is linked with. Defaults to the empty string, which implies that these credentials have been configured already in the cluster.</p>
<h4 id="avp-values_varname"><code>&lt;avp-values_varname&gt;</code><a class="headerlink" href="#avp-values_varname" title="Permanent link"></a></h4>
<p>The name of the environment variable used to pass values inline to AVP. Defaults to <code>HELM_VALUES</code>.</p>
<h4 id="auto_delete"><code>auto_delete</code><a class="headerlink" href="#auto_delete" title="Permanent link"></a></h4>
<p>Defaults to <code>false</code>. </p>
<p>If <code>true</code>, ArgoCD will be permitted to automatically delete ArgoCD Applications on the <strong>Management Cluster</strong> and Kubernetes resources on the Target Clusters where it sees fit. This may happen because configuration is deleted from the <strong>Config Repository</strong> for a particular Application or resource, or some change is made to the charts in the <strong>Source Repository</strong>.</p>
<p>If <code>false</code>, ArgoCD will never delete a resource automatically. Instead, when ArgoCD deems that a resource should be removed, it will simply flag it as "pending removal" (with a small yellow trashcan icon). In order for an ArgoCD Application or resource on the Target Cluster to actually be deleted, a manual sync with the <code>Prune</code> optional enabled must be issued for the ArgoCD Application that owns the resource.</p>
<p>Since the <strong>Cluster</strong> and <strong>Instance</strong> root applications are generated by an Application Set, they behave slightly differently when <code>auto_delete</code> is <code>false</code>. They will be marked for removal if the <code>ibm-mas-cluster-base.yaml</code> or <code>ibm-mas-instance-base.yaml</code> files are removed from the <strong>Config Repository</strong>. No indication will be given in the ArgoCD that this has occurred, but ArgoCD will stop synchronizing configuration changes to the Application. The user must manually issue a <strong>delete</strong> operation against the Application for it to be deleted.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To mitigate risk of accident deletions / downtime in production systems, we strongly recommend that <code>auto_delete: true</code> is used in development environments only.</p>
</div>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tomklapiscak/mkdocsmike" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../orchestration/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../limitations/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
