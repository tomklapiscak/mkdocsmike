name: Build Documentation
on:
  push:
    tags: [ '*.*.*' ]
    branches:
      - main
      - dev

jobs:
  deploy-docs:
    runs-on: ubuntu-latest
    steps:


      - name: Install Python dependencies
        run: |
          python -m pip install -q mkdocs
          python -m pip install -q mkdocs-redirects
          python -m pip install -q mkdocs-macros-plugin
          python -m pip install -q mkdocs-drawio-file
          python -m pip install -q mike

      - name: Checkout
        uses: actions/checkout@v4

      - name: Get branch name
        shell: bash
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF} | sed -rn "s/refs\/(tags\/([0-9]+\.[0-9]+).*|heads\/(.*))/\2\3/p")"
        id: get_branch_name

      - name: Deploy with mike ðŸš€
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git fetch origin gh-pages --depth=1
          echo "Pushing docs for version ${{ steps.get_branch_name.outputs.branch }}"
          mike deploy --push ${{ steps.get_branch_name.outputs.branch }}